<!DOCTYPE html><html class="appearance-auto" lang="zh-CN"><head><meta charset="UTF-8"><title>关于SQLite的各种趣事</title><meta name="description" content="Stay Simple, Stay Hungry, Stay Foolish."><meta name="viewport" content="width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no,initial-scale=1"><link rel="icon" href="/images/favicon.ico"><link rel="stylesheet" href="/style/common/bulma.css"><link rel="stylesheet" href="/style/base.css"><link rel="stylesheet" href="/style/common/helper.css"><script src="/js/common.js"></script><link rel="stylesheet" href="/style/post.css"><link rel="stylesheet" href="/style/themes/highlight-theme-light.css"><link rel="stylesheet" href="/style/common/jquery.fancybox.min.css"><script src="/js/highlight.pack.js"></script><meta name="description" content="


原文链接：关于 SQLite 的疯狂和有趣的事实集合 - blag



SQLite 是部署最多、使用最多的数据库。有超过一万亿（1000000000000000 或一百万）个 SQLite 数据库正在积极使用。
它由三个人维护。他们不允许外部贡献。


SQLite 的使用量可能比所有其他数据库引擎的总和还要多。数十亿个 SQLite 副本存在于野外。它无处不在。


它也可能是部署最多的五个软件模块之一。


Hwaci 是 SQLite 背后的公司。他们也喜欢音乐（？



SQLite 起源于一艘美国军舰。D. Richard Hipp （DRH） 正在为海军驱逐舰 USS Oscar Austin 构建软件。每当服务器出现故障时，现有软件就会停止工作（这是在 2000 年代）。对于一艘战列.."><meta name="generator" content="Hexo 7.3.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
<link rel="alternate" href="/atom.xml" title="靳马珏日志" type="application/atom+xml">
</head><body class="is-flex is-flex-direction-column"><header class="header-widget is-flex-shrink-0 is-hidden-mobile"><div class="container is-fullhd is-flex is-justify-content-space-between is-align-items-center is-full-height"><section class="is-hidden-mobile is-flex-shrink-0"><h2><a href="/">Haojen's blog</a></h2></section><h3 class="is-hidden-mobile is-family-serif is-full-height is-flex is-align-items-center is-flex-shrink-0"><div class="is-full-height" id="postTopic"><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">关于SQLite的各种趣事</p><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">点击返回顶部</p></div></h3><aside class="is-flex-shrink-0"><h3 class="is-inline-block"><a href="/">首页</a></h3><h3 class="is-inline-block"><a href="/about">关于</a></h3><h3 class="is-inline-block"><a href="/archives">归档</a></h3></aside></div></header><header class="is-flex header-widget is-flex-shrink-0 is-align-items-center is-justify-content-center is-hidden-tablet"><h3 class="is-inline-block"><a href="/">首页</a></h3><h3 class="is-inline-block"><a href="/about">关于</a></h3><h3 class="is-inline-block"><a href="/archives">归档</a></h3></header><main><main class="container is-max-widescreen content section post-page pt-4 px-4"><div class="columns is-flex-desktop is-justify-content-center is-flex-direction-row-reverse"><div class="column is-3 is-hidden-mobile is-hidden"></div><div class="column is-9"><header class="my-4"><a href="/tags/notes"><i class="tag post-item-tag">notes</i></a></header><h1 class="mt-0 mb-1 is-family-serif" id="postTitle">关于SQLite的各种趣事</h1><time class="has-text-grey" datetime="2025-01-13T07:51:13.000Z">2025-01-13</time><article class="mt-2 post-content"><hr><hr><hr><p>原文链接：<a target="_blank" rel="noopener" href="https://avi.im/blag/2024/sqlite-facts/">关于 SQLite 的疯狂和有趣的事实集合 - blag</a></p><hr><ol><li><p>SQLite 是部署最多、使用最多的数据库。有超过一万亿（1000000000000000 或一百万）个 SQLite 数据库正在积极使用。</p><p>它由<a target="_blank" rel="noopener" href="https://www.sqlite.org/crew.html">三个人</a>维护。他们不允许外部贡献。</p></li><li><p>SQLite 的使用量可能比所有其他数据库引擎的总和还要多。数十亿个 SQLite 副本存在于野外。它无处不在。</p></li><li><p>它也可能是部署最多的五个软件模块之一。</p></li><li><p><a target="_blank" rel="noopener" href="https://hwaci.com/">Hwaci</a> 是 SQLite 背后的公司。他们也喜欢音乐（？</p><p><img src="https://avi.im/blag/images/2024/sqlite-fact-3.png" alt="img"></p></li><li><p>SQLite 起源于一艘美国军舰。D. Richard Hipp （DRH） 正在为海军驱逐舰 USS Oscar Austin 构建软件。每当服务器出现故障时，现有软件就会停止工作（这是在 2000 年代）。对于一艘战列舰来说，这是不可接受的。</p><p>因此，DRH 提出了一个问题：如果数据库在没有任何服务器的情况下工作呢？用 DRH 的话来说：</p><blockquote><p>为什么我们甚至需要一个服务器？为什么我不能直接从磁盘驱动器上拉出它？这样，如果计算机足够健康，它就可以运行我们的应用程序，我们没有可能失败并导致我们失败的依赖项，我环顾四周，没有 SQL 数据库引擎可以做到这一点，与我一起工作的一个人说，“Richard，你为什么不写一个呢？“好吧，我试一试。”我没有立即这样做，但后来，资金中断了。那是在 2000 年，如果我没记错的话，纽特·金里奇和比尔·克林顿正在发生某种争吵，所以所有的政府合同都被关闭了，所以我失业了几个月，我想，“好吧，我现在就写那个数据库引擎吧。</p></blockquote></li><li><p>与大多数使用标准许可证（如 MIT 或 GPL）的开源项目不同，SQLite 不附带 OSI 批准的许可证。</p><p>相反，SQLite 被发布到公共领域，并且限制更少。</p><p>另请注意，在一些不承认公有领域的国家/地区/司法管辖区，这可能是<a target="_blank" rel="noopener" href="https://opensource.org/blog/public-domain-is-not-open-source">一个问题</a>。因此，SQLite <a target="_blank" rel="noopener" href="https://www.sqlite.org/purchase/license">出售许可证</a>，称为“所有权保证”。</p></li><li><p>他们不允许外部贡献。<em>你不能</em>只是发送一个 pull request 并希望补丁会被接受。</p></li><li><p>开源，而不是开放贡献</p><p>为 SQLite 做贡献是仅限邀请的（我没有源代码）。只有在您收到邀请并签署了一份宣誓书，将你的贡献献给公共领域后，你才能提交补丁。</p></li><li><p>他们是怎么做饭的？</p><p>SQLite 中的每一行代码都有超过 600 行测试代码。测试覆盖库中 100% 的分支（和 100% <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Modified_condition/decision_coverage">的 MC/DC</a>）。该测试套件非常多样化，包括模糊测试、边界值测试、回归测试以及模拟操作系统崩溃、电源损失、I/O 错误和内存不足错误的测试。</p><p>SQLite 最初是作为 <a target="_blank" rel="noopener" href="https://www.sqlite.org/tclsqlite.html">Tcl 扩展</a>开始的，其主要测试套件是用 Tcl 编写的。</p></li><li><p>有趣的是，一些 SQLite 测试是专有的。名为 <a target="_blank" rel="noopener" href="https://www.sqlite.org/th3.html">TH3 （Test Harness 3）</a> 的测试套件可实现代码的 100% 分支覆盖率，是专有的，不开放访问。</p><p>我不知道有任何其他项目使代码免费，但测试套件是付费的。</p><p>然而，他们无法销售 TH3 的一份副本。DRH 在播客中说：</p><blockquote><p>100% MCD 测试，称为 TH3。那是专有的。我的想法是，我们将这些测试出售给航空电子设备制造商，并以这种方式赚钱。我们正好卖了零份，所以这并没有真正奏效。</p></blockquote><p>为了获得访问权限，需要成为 SQLite Consortium 的一员，每年的费用为 120K 美元。</p></li><li><p>这是一个有趣的商业模式。他们通过许可证、付费支持、维护服务、联盟成员资格和商业扩展来产生收入。</p></li><li><p>SQLite 没有行为准则 （CoC），而是源自《圣本笃规则》第 4 章中的“善行工具”的<a target="_blank" rel="noopener" href="https://sqlite.org/codeofethics.html">道德准则</a></p></li><li><p>在 SQLite 中：代替法律声明，这里有一个<a target="_blank" rel="noopener" href="https://github.com/sqlite/sqlite/blob/624cb96/src/wal.c#L4,#L9">祝福</a>：</p><p>所有的源代码文件都附带了一个祝福。</p></li><li><p>SQLite 的速度如此之快，它们与 .对于某些用例，您可以使用 SQLite 而不是文件系统，这可以加快 35% 的速度。<code>fopen</code></p></li><li><p>SQLite 与 Redis（猜猜哪个更快？</p><p>对于<a target="_blank" rel="noopener" href="https://x.com/iavins/status/1849422515027763227">某些用例</a>，由于网络堆栈和（反）序列化开销，SQLite 可能比 Redis 更快。</p></li><li><p>但是，与大多数数据库不同的是，SQLite 只有一个写入器模型。不能有多个并发写入器。</p><p>最近在 2010 年，通过添加 WAL 模式，这种情况也发生了变化。在此之前，您可以拥有读者或作家，但永远不能在一起。</p></li><li><p>还有其他一些事情在其他数据库中很常见，但在 SQLite 中却不常见：</p><ul><li>默认值为 rollback journal 模式，该模式限制您拥有多个读取器或单个写入器</li><li>外键已禁用;他们是自愿加入的</li><li>它是 “弱类型”。SQLite 称其为“类型亲和性”。这意味着即使你已经定义了一个类型，你也可以在列中插入任何内容。强类型列是可选的（由 <a target="_blank" rel="noopener" href="https://www.sqlite.org/stricttables.html"><code>STRICT</code></a> 表）。</li><li>您在其他数据库中期望的许多 <a target="_blank" rel="noopener" href="https://sqlite.org/omitted.html"><code>ALTER</code> 命令</a>不起作用。例如，您不能向现有列添加约束。（他们最近添加了重命名列名称的功能）</li></ul><p>这里有一整套<a target="_blank" rel="noopener" href="https://www.sqlite.org/quirks.html">怪癖。</a></p></li><li><p>我讨厌它不强制类型。这完全是 YOLO：</p><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE TABLE</span> <span class="hljs-keyword">user</span>(id <span class="hljs-type">INTEGER</span>);<br><span class="hljs-keyword">INSERT into</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">VALUES</span> ("YOLO!"); <span class="hljs-comment">--- This works!</span><br></code></pre></td></tr></tbody></table></figure><p>不仅如此，如果你给出一些随机类型，它不会引发任何错误。</p><p><code>CREATE TABLE t(value TIMMYSTAMP);</code></p><p>没有类型，但 SQLite 很高兴地接受这一点。<code>TIMMYSTAMP</code></p><p>SQLite 有五种类型：、、、、、 .想知道什么被诅咒的东西吗？类型亲和性通过<a target="_blank" rel="noopener" href="https://www.sqlite.org/datatype3.html#determination_of_column_affinity">子字符串匹配</a>工作！<code>NULL``INTEGER``REAL``TEXT``BLOB</code></p><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE TABLE</span> t(<span class="hljs-keyword">value</span> SPONGEBLOB) <span class="hljs-comment">--- This is BLOB type!</span><br></code></pre></td></tr></tbody></table></figure><p>所以，是的，这也发生了：</p><blockquote><p>请注意，由于 “POINT” 末尾的 “INT” ，声明的 “FLOAT POINT” 类型将提供 INTEGER 关联，而不是 REAL 关联。</p></blockquote></li><li><p>这是我<a target="_blank" rel="noopener" href="https://x.com/iavins/status/1865746403072389612">最喜欢的传说</a>之一。SQLite 不得不将默认前缀从 更改为用户在半夜开始给开发人员打电话<code>sqlite_``etilqs_</code></p></li><li><p>SQLite 非常重视向后兼容性</p><blockquote><p>SQLite 版本 3 的所有版本都可以读取和写入由第一个 SQLite 3 版本（版本 3.0.0）创建的数据库文件，其历史可以追溯到 2004 年 6 月 18 日。这就是 “向后兼容性”。开发人员承诺为 SQLite 3 的所有未来版本保持数据库文件格式的向后兼容性。</p></blockquote></li><li><p>但是他们非常重视向后兼容性，以至于即使他们<a target="_blank" rel="noopener" href="https://x.com/iavins/status/1851276312876326980">发布了一个 bug</a>，他们也不会修复它</p></li><li><p>SQLite 的作者 D. Richard Hipp （DRH） 认为现有的版本控制系统不合适。所以他写了自己的书，叫<a target="_blank" rel="noopener" href="https://fossil-scm.org/home/doc/trunk/www/fossil-v-git.wiki">做 Fossil</a>。当然，Fossil 是由 SQLite 提供支持的。</p><p>这让我想起了 Linus 是如何编写 Git 的。</p><p>DRH 还编写了自己的解析器生成器，名为 Lemon。</p></li><li><p>DRH 根据 Donald Knuth 的 TAOCP 一书中的算法编写了 B 树，并在旅行时在飞机上对其进行编码（基于超级）</p></li><li><p>SQLite 发音为“Ess-Cue-El-ite”。不过，没有官方指南。<a target="_blank" rel="noopener" href="https://web.archive.org/web/20201126110450/http://sqlite.1065341.n5.nabble.com/SQLite-Pronunciation-td88186.html#message88194">SQLite 论坛</a>中提到的 DRH：</p><blockquote><p>我写了 SQLite，我认为它应该发音为“S-Q-L-ite”。就像一种矿物。但是我很酷你们想怎么发音就怎么发音。</p><p>😃</p></blockquote></li></ol></article><section class="jump-container is-flex is-justify-content-space-between my-6"><em></em><a class="button is-default" href="/posts/540c6e02/" title="如何阅读科研论文"><span class="has-text-weight-semibold">下一页: 如何阅读科研论文</span><i class="iconfont icon-next ml-2 has-text-grey"></i></a></section><article class="mt-6 comment-container"><script async repo="Haojen/Claudia-theme-blog" src="https://utteranc.es/client.js" issue-term="pathname" theme="preferred-color-scheme"></script></article></div></div></main></main><footer class="is-flex is-flex-direction-column is-align-items-center is-flex-shrink-0 is-family-serif"><section class="sns-container"><a title="twitter" target="_blank" rel="noopener nofollow" href="//twitter.com//"><i class="iconfont icon-twitter"></i></a><a title="github" target="_blank" rel="noopener nofollow" href="//github.com/haojen"><i class="iconfont icon-github"></i></a><a title="instagram" target="_blank" rel="noopener nofollow" href="//www.instagram.com//"><i class="iconfont icon-ins"></i></a><a title="facebook" target="_blank" rel="noopener nofollow" href="//www.facebook.com//"><i class="iconfont icon-tian7_facebook"></i></a></section><p><span>Copyright ©</span><span> Haojen 2025</span></p><div class="is-flex is-justify-content-center is-flex-wrap-wrap"><p>Powered by Hexo &verbar;&nbsp;</p><p class="is-flex is-justify-content-center"><a title="Hexo theme author" target="_blank" rel="noopener" href="//github.com/haojen">Theme by Haojen&nbsp;</a></p><div style="margin-top:2px"><a class="github-button" title="github-button" target="_blank" rel="noopener" href="https://github.com/haojen/hexo-theme-Claudia" data-color-scheme="no-preference: light; light: light; dark: dark;" data-show-count="true"></a></div></div><div><span></span></div></footer><script async defer src="https://buttons.github.io/buttons.js"></script><script src="/js/jquery-3.6.1.min.js"></script><script src="/js/jquery-fancybox.min.js"></script><script src="/js/img_zoom.js"></script><script src="/js/post.js"></script></body></html>